<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sansushi France üç£ - Roulette</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #000;
  color: #fff;
  text-align: center;
  margin: 0;
  padding: 0;
}
h1 { margin-top: 20px; color: #ff5656; }
p.subtitle { font-size: 18px; margin-bottom: 20px; color: #fff; }
#wheelCanvas { margin-top: 0; border-radius: 50%; }
#spinBtn {
  margin-top: 20px; padding: 15px 30px; font-size: 18px;
  background: #ff5656; color: #fff; border: none; border-radius: 50px;
  cursor: pointer; transition: 0.3s;
}
#spinBtn:hover { background: #e04e4e; }
#result { margin-top: 25px; font-size: 20px; font-weight: bold; color: #ff5656; }
.pointer{
  width:0; height:0;
  border-left: 20px solid transparent;
  border-right: 20px solid transparent;
  border-top: 40px solid #ff5656;
  margin: 0 auto 14px auto;
  position: relative; z-index: 10;
  filter: drop-shadow(0 2px 2px rgba(0,0,0,0.4));
}
.note { margin-top: 40px; font-size: 12px; color: #bbb; }
</style>
</head>
<body>
<h1>Sansushi France üç£</h1>
<p class="subtitle">Merci pour votre avis Google ‚≠êÔ∏è<br>Tournez la roue et d√©couvrez votre d√©licieuse r√©compense üéÅ</p>

<div class="pointer"></div>
<canvas id="wheelCanvas" width="350" height="350"></canvas>
<br/>
<button id="spinBtn">Tournez la roue üéÅ</button>
<p id="result"></p>
<p class="note">*Sous r√©serve de nous montrer la preuve de votre avis Google.</p>

<script>
const canvas = document.getElementById("wheelCanvas");
const ctx = canvas.getContext("2d");
const spinBtn = document.getElementById("spinBtn");
const result = document.getElementById("result");

const rewards = [
  "ü•§ Boisson",
  "üßã Bubble Tea",
  "üç´ Fondant\nau chocolat",
  "üç∞ Tiramisu",
  "üçó Nems Poulet",
  "üç£ Sushis Saumon"
];
const colors = ["#ff5656","#111","#ff5656","#111","#ff5656","#111"];

let startAngle = 0;
const arc = (2 * Math.PI) / rewards.length;

const PLAY_KEY = "wheelPlayed_sansushi_v4";
if (localStorage.getItem(PLAY_KEY) === "true") {
  spinBtn.disabled = true;
  spinBtn.innerText = "Vous avez d√©j√† jou√© üéâ";
}

function drawRouletteWheel() {
  ctx.clearRect(0, 0, 350, 350);
  ctx.strokeStyle = "white";
  ctx.lineWidth = 2;
  ctx.font = "bold 14px Arial";

  for (let i = 0; i < rewards.length; i++) {
    const angle = startAngle + i * arc;
    ctx.fillStyle = colors[i];

    ctx.beginPath();
    ctx.arc(175, 175, 175, angle, angle + arc, false);
    ctx.arc(175, 175, 0, angle + arc, angle, true);
    ctx.fill();
    ctx.save();

    ctx.fillStyle = "#fff";
    ctx.translate(
      175 + Math.cos(angle + arc / 2) * 110,
      175 + Math.sin(angle + arc / 2) * 110
    );
    ctx.rotate(angle + arc / 2);
    ctx.textAlign = "center";
    const lines = rewards[i].split("\n");
    lines.forEach((line, idx) => ctx.fillText(line, 0, idx * 16));
    ctx.restore();
  }
}

// Fonction de rotation avec d√©c√©l√©ration progressive
function spinWheel() {
  // Choisir un index gagnant al√©atoire
  const rewardIndex = Math.floor(Math.random() * rewards.length);

  // Nombre de tours complets avant de s'arr√™ter (plus = plus long)
  const fullTurns = 5;

  // Angle final exact centr√© sur le segment gagnant
  const finalAngle = fullTurns * 2 * Math.PI + rewardIndex * arc + arc/2;

  let currentAngle = startAngle;
  let frames = 120; // nombre de frames pour l'animation
  let frameCount = 0;

  function animate() {
    frameCount++;
    // D√©c√©l√©ration progressive (ease out)
    const t = frameCount / frames;
    const easeOut = 1 - Math.pow(1 - t, 3); // fonction cubic ease out
    startAngle = currentAngle + (finalAngle - currentAngle) * easeOut;
    drawRouletteWheel();

    if (frameCount < frames) {
      requestAnimationFrame(animate);
    } else {
      // Afficher le r√©sultat
      result.innerText = `üéâ F√©licitations ! Vous avez gagn√© : ${rewards[rewardIndex]}`;
      localStorage.setItem(PLAY_KEY, "true");
      spinBtn.disabled = true;
      spinBtn.innerText = "Vous avez d√©j√† jou√© üéâ";
    }
  }

  animate();
}

spinBtn.addEventListener("click", () => {
  if (localStorage.getItem(PLAY_KEY) === "true") {
    result.innerText = "‚ö†Ô∏è Vous avez d√©j√† jou√© !";
    return;
  }
  spinWheel();
});

drawRouletteWheel();
</script>
</body>
</html>
